[gd_scene load_steps=27 format=2]

[ext_resource path="res://scene/Camera.tscn" type="PackedScene" id=1]
[ext_resource path="res://material/env/ocean.tres" type="Material" id=2]
[ext_resource path="res://script/scene/AScenePlay.cs" type="Script" id=3]
[ext_resource path="res://geometry/cylinder_mesh.tres" type="ArrayMesh" id=4]
[ext_resource path="res://audio/music/lofi_01.mp3" type="AudioStream" id=5]
[ext_resource path="res://texture/sun_flare4.png" type="Texture" id=6]
[ext_resource path="res://material/grass.material" type="Material" id=7]
[ext_resource path="res://script/scene/ANodeLoader.cs" type="Script" id=12]
[ext_resource path="res://scene/test/particles.tscn" type="PackedScene" id=13]

[sub_resource type="Environment" id=1]
ambient_light_color = Color( 0.501961, 0.501961, 0.501961, 1 )
fog_depth_begin = 100.0
fog_depth_end = 1000.0
ss_reflections_fade_in = 0.0375
ss_reflections_fade_out = 1.6245
ss_reflections_roughness = false
dof_blur_far_distance = 150.0
dof_blur_far_transition = 200.0
dof_blur_near_distance = 1.29

[sub_resource type="CubeMesh" id=2]

[sub_resource type="Shader" id=3]
code = "shader_type spatial;
render_mode blend_mix,depth_draw_opaque,cull_front,diffuse_burley,specular_schlick_ggx,unshaded,shadows_disabled,ambient_light_disabled,skip_vertex_transform;

uniform sampler2D texture_albedo : hint_albedo;
uniform float specular;
uniform float metallic;
uniform float roughness : hint_range(0,1);

uniform mat4 par1;

uniform vec4 day_color : hint_color;
uniform vec4 day2_color : hint_color;
uniform vec4 night_color : hint_color;
uniform vec4 sun_color : hint_color;
uniform vec4 dawn_color : hint_color;

vec3 smoothmix(vec3 a, vec3 b, float low, float high, float t) {
    return mix(a, b, smoothstep(low, high, t));
}

void vertex() {
	//UV=UV*uv1_scale.xy+uv1_offset.xy;
	VERTEX = mat3(MODELVIEW_MATRIX) * VERTEX;
    //NORMAL = normalize((MODELVIEW_MATRIX * vec4(NORMAL, 0.0)).xyz);
    // same as above for binormal and tangent, if normal mapping is used
}

void fragment() {
	//vec2 base_uv = UV;
	//vec4 albedo_tex = texture(texture_albedo,base_uv);
	//ALBEDO = albedo.rgb * albedo_tex.rgb;
	//METALLIC = metallic;
	//ROUGHNESS = roughness;
	//SPECULAR = specular;
	
	vec3 cam_dir = mat3(CAMERA_MATRIX) * -VIEW; //vec3 cam_dir = normalize(mat3(CAMERA_MATRIX) * VERTEX);
	vec3 sun_dir = par1[0].xyz;
	
	//vec3 cam_pos = CAMERA_MATRIX[3].xyz;

	float sun = dot(cam_dir, sun_dir) * -0.5 + 0.5;
	float day = par1[1].x; //dot(normalize(cam_pos), sun_dir) * -0.5 + 0.5;
	
	vec3 col = mix(day_color.rgb, day2_color.rgb, sun);
	
	vec3 dawn = night_color.rgb; //smoothmix(night_color.rgb, dawn_color.rgb, 0.8, 1.0, sun * (1.0 - day));
	
	col = mix(dawn, col, day);
	
	
	///// sun
    col = smoothmix(col, sun_color.rgb, .995, .997, sun);
	//col = mix(col, sun_color.rgb, step(.90, sun));
	
	//col = vec3(sun);
	
	ALBEDO = col;
	
}


"

[sub_resource type="ShaderMaterial" id=4]
shader = SubResource( 3 )
shader_param/specular = 0.5
shader_param/metallic = 0.0
shader_param/roughness = 1.0
shader_param/par1 = Transform( 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 )
shader_param/day_color = Color( 0.196078, 0.305882, 1, 1 )
shader_param/day2_color = Color( 0.423529, 0.541176, 1, 1 )
shader_param/night_color = Color( 0, 0, 0, 1 )
shader_param/sun_color = Color( 1, 0.882353, 0.486275, 1 )
shader_param/dawn_color = Color( 1, 0.517647, 0.0470588, 1 )

[sub_resource type="SphereShape" id=5]

[sub_resource type="SphereMesh" id=6]

[sub_resource type="QuadMesh" id=12]

[sub_resource type="SpatialMaterial" id=13]
flags_transparent = true
flags_unshaded = true
params_cull_mode = 2
albedo_color = Color( 1, 0, 0, 0.215686 )

[sub_resource type="SpatialMaterial" id=14]
flags_transparent = true
flags_unshaded = true
params_cull_mode = 2
albedo_color = Color( 0, 1, 0, 0.215686 )

[sub_resource type="SpatialMaterial" id=15]
flags_transparent = true
flags_unshaded = true
params_cull_mode = 2
albedo_color = Color( 0, 0, 1, 0.215686 )

[sub_resource type="CylinderShape" id=11]

[sub_resource type="SpatialMaterial" id=9]
params_billboard_mode = 3
particles_anim_h_frames = 1
particles_anim_v_frames = 1
particles_anim_loop = false

[sub_resource type="QuadMesh" id=10]
material = SubResource( 9 )

[sub_resource type="Curve" id=23]
_data = [ Vector2( 0, 0 ), 0.0, 0.0, 0, 0, Vector2( 0.182119, 1 ), 0.0, 0.0, 0, 0, Vector2( 0.847682, 1 ), 0.0, 0.0, 0, 0, Vector2( 0.993377, 0 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="SpatialMaterial" id=24]
flags_transparent = true
params_billboard_mode = 3
particles_anim_h_frames = 1
particles_anim_v_frames = 1
particles_anim_loop = false
albedo_texture = ExtResource( 6 )

[sub_resource type="QuadMesh" id=25]
material = SubResource( 24 )

[sub_resource type="Curve" id=26]
bake_resolution = 20
_data = [ Vector2( 0, 0 ), 0.0, 25.7236, 0, 0, Vector2( 0.122137, 1 ), 0.0, 0.0, 0, 0, Vector2( 0.870229, 1 ), 0.0, 0.0, 0, 0, Vector2( 1, 0 ), -16.408, 0.0, 0, 0 ]

[node name="world_environment" type="WorldEnvironment"]
environment = SubResource( 1 )

[node name="Root" type="Spatial" parent="."]
script = ExtResource( 3 )
GRAVITY_SCALE = -20.0
SUN_DAY_COLOR = Color( 1, 0.972549, 0.882353, 1 )
SUN_DAWN_COLOR = Color( 0.933594, 0.295395, 0.759086, 1 )
ui_resource = "res://scene/UI/UI_play.tscn"
cursor_resource = "res://scene/editor/Cursor.tscn"
player_resource = "res://scene/person/GyMan.tscn"
pause_music = NodePath("Music")

[node name="directional_light" type="DirectionalLight" parent="Root"]
directional_shadow_mode = 0

[node name="sky" type="MeshInstance" parent="Root"]
transform = Transform( 2000, 0, 0, 0, 2000, 0, 0, 0, 2000, 0, 0, 0 )
cast_shadow = 0
mesh = SubResource( 2 )
material/0 = SubResource( 4 )

[node name="Camera" parent="Root" instance=ExtResource( 1 )]
transform = Transform( 1, 0, 0, 0, 0.934173, 0.35682, 0, -0.35682, 0.934173, 0, 1070, 119.063 )
far = 99999.0

[node name="Core" type="StaticBody" parent="Root"]
transform = Transform( 1000, 0, 0, 0, 1000, 0, 0, 0, 1000, 0, 0, 0 )
collision_mask = 3

[node name="CollisionShape" type="CollisionShape" parent="Root/Core"]
shape = SubResource( 5 )

[node name="SphereCap" type="MeshInstance" parent="Root/Core"]
mesh = SubResource( 6 )
material/0 = ExtResource( 2 )

[node name="content" type="Spatial" parent="Root"]

[node name="slices" type="Spatial" parent="Root/content"]
visible = false

[node name="x" type="MeshInstance" parent="Root/content/slices"]
transform = Transform( -8.74228e-05, 0, 2000, 0, 2000, 0, -2000, 0, -8.74228e-05, 0, 0, 0 )
mesh = SubResource( 12 )
material/0 = SubResource( 13 )

[node name="y" type="MeshInstance" parent="Root/content/slices"]
transform = Transform( 2000, 0, 0, 0, -8.74228e-05, -2000, 0, 2000, -8.74228e-05, 0, 0, 0 )
mesh = SubResource( 12 )
material/0 = SubResource( 14 )

[node name="z" type="MeshInstance" parent="Root/content/slices"]
transform = Transform( 2000, 0, 0, 0, 2000, 0, 0, 0, 2000, 0, 0, 0 )
mesh = SubResource( 12 )
material/0 = SubResource( 15 )

[node name="Y+" type="Spatial" parent="Root/content"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1000, 0 )

[node name="_Y+" type="StaticBody" parent="Root/content/Y+"]
transform = Transform( 100, 0, 0, 0, 10, 0, 0, 0, 100, 0, 6.10352e-05, 0 )

[node name="collision_shape" type="CollisionShape" parent="Root/content/Y+/_Y+"]
shape = SubResource( 11 )

[node name="mesh_instance" type="MeshInstance" parent="Root/content/Y+/_Y+"]
mesh = ExtResource( 4 )
material/0 = ExtResource( 7 )

[node name="particles" type="Spatial" parent="Root/content/Y+"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 56.9958, 0 )

[node name="cpu_particles" type="CPUParticles" parent="Root/content/Y+/particles"]
amount = 80
lifetime = 10.56
mesh = SubResource( 10 )
emission_shape = 1
emission_sphere_radius = 62.2
direction = Vector3( 0, -1, 0 )
gravity = Vector3( 0, 0, 0 )
initial_velocity = 20.0
initial_velocity_random = 0.67
scale_amount_curve = SubResource( 23 )

[node name="spatial" parent="Root/content/Y+/particles" instance=ExtResource( 13 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 84.8247 )

[node name="Y-" type="Spatial" parent="Root/content"]
transform = Transform( 1, 0, 0, 0, -1, 0, 0, 0, -1, 0, -1000, 0 )

[node name="X+" type="Spatial" parent="Root/content"]
transform = Transform( 0, 1, 0, -1, 0, 0, 0, 0, 1, 1000, 0, 0 )

[node name="X-" type="Spatial" parent="Root/content"]
transform = Transform( 0, -1, 0, 1, 0, 0, 0, 0, 1, -1000, 0, 0 )

[node name="Z+" type="Spatial" parent="Root/content"]
transform = Transform( 1, 0, 0, 0, 0, -1, 0, 1, 0, 0, 0, 1000 )

[node name="Z-" type="Spatial" parent="Root/content"]
transform = Transform( 1, 0, 0, 0, 0, 1, 0, -1, 0, 0, 0, -1000 )

[node name="clouds" type="Spatial" parent="Root/content"]

[node name="cpu_particles" type="CPUParticles" parent="Root/content/clouds"]
emitting = false
amount = 100
lifetime = 10.0
preprocess = 2.49
mesh = SubResource( 25 )
emission_shape = 1
emission_sphere_radius = 1600.0
spread = 180.0
gravity = Vector3( 0, 0, 0 )
initial_velocity = 79.14
scale_amount = 691.64
scale_amount_curve = SubResource( 26 )

[node name="zones" type="Spatial" parent="Root"]

[node name="loader" type="Node" parent="Root/zones"]
script = ExtResource( 12 )
State = 1
check_type = 2
load_value = -0.1
unload_value = 0.1
files = PoolStringArray( "res://scene/island/small_mountain.tscn", "res://scene/island/city.tscn", "res://scene/island/big_mountain.tscn", "res://scene/island/lighthouse.tscn", "res://scene/island/bridge.tscn", "res://scene/island/palace.tscn", "res://scene/island/forest.tscn", "res://scene/island/castle.tscn", "res://scene/island/vilage.tscn", "res://scene/island/hills.tscn", "res://scene/island/desert.tscn" )
positions = PoolVector3Array( -750.153, 543.087, -131.689, -226.987, -220.473, -930.278, 878.143, -433.176, -169.486, 36.5818, -242.106, 969.495, 404.312, -408.315, 810.551, 707.777, -547.986, 446.43, 377.684, 766.715, 521.537, -845.994, -469.065, -193.431, 921.153, 392.433, -174.622, -116.936, 998.851, 0, 0, -1055.7, 0 )
rotations = PoolVector3Array( -0.0873782, -0.111274, 0.948623, -1.33601, 3.10638, -2.87423, 0.0797123, 0.15196, -2.02339, 1.32608, -3.14159, 3.105, 1.11812, -3.06378, 2.79225, -0.276748, -0.375631, -2.17671, 0.597329, -1.67466e-07, -0.386785, 0.0952253, -0.173131, 2.06878, -0.0673894, 0.159093, -1.17343, 0, 0, 0.116541, 1.17094e-17, 3.14159, 3.14159 )
scales = PoolVector3Array( 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.999999, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 )

[node name="Music" type="AudioStreamPlayer" parent="Root"]
stream = ExtResource( 5 )
